# File: ./nginx/nginx.conf

server {
    # Nginx lắng nghe cổng 80 (đã được ánh xạ ra cổng 8088 trên máy chủ)
    listen 80;
    server_name dauvankhanh.com;

    # CẤU HÌNH REVERSE PROXY cho API ĐĂNG NHẬP
    # Mọi yêu cầu đến http://localhost:8088/api/login sẽ được chuyển đến Node-RED
    location /api/login {
        # 'nodered' là tên dịch vụ Docker Compose, '1880' là cổng Node-RED
        proxy_pass http://nodered:1880/api/login; 
        
        # Thiết lập các header chuẩn
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Cấu hình cần thiết cho WebSockets (quan trọng cho Node-RED)
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    # CẤU HÌNH PHỤC VỤ TỆP TĨNH
    # Phục vụ các tệp HTML, CSS, JS từ thư mục ./nginx/html
    location / {
        root /usr/share/nginx/html;
        index index.html index.htm;
        try_files $uri $uri/ =404;
    }

    # Bạn có thể thêm các cấu hình proxy khác cho Grafana/phpMyAdmin ở đây
}